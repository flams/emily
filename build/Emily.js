define("Observable",["Tools"],function(a){return function(){var b={};this.watch=function(a,c,d){if(typeof c=="function"){var e=b[a]=b[a]||[];observer=[c,d];e.push(observer);return[a,e.indexOf(observer)]}else return false};this.unwatch=function(a){var c=a[0],a=a[1];return b[c]&&b[c][a]?(b[c][a]=null,true):false};this.notify=function(f){var c=b[f],d;if(c){for(d=c.length;d--;)c[d]&&c[d][0].apply(c[d][1]||null,a.toArray(arguments).slice(1));return true}else return false};this.hasObserver=function(a){return!(!a||
!b[a[0]]||!b[a[0]][a[1]])};this.unwatchAll=function(a){b[a]?delete b[a]:b={};return true}}});
define("StateMachine",["Tools"],function(a){function b(){var a={};this.add=function(c,b,e,g){var h=[];if(a[c])return false;return typeof c=="string"&&typeof b=="function"?(h[0]=b,typeof e=="object"&&(h[1]=e),typeof e=="string"&&(h[2]=e),typeof g=="string"&&(h[2]=g),a[c]=h,true):false};this.has=function(c){return!!a[c]};this.event=function d(d,b){var g=a[d];return g?(g[0].call(g[1],b),g[2]):false}}return function(f,c){var d={},e="";this.init=function(a){return d[a]?(e=a,true):false};this.add=function(a){return d[a]?
false:d[a]=new b};this.get=function(a){return d[a]};this.getCurrent=function(){return e};this.event=function(a,c){var b=d[e].event(a,c);return b===false?false:(e=b||e,true)};a.loop(c,function(a,c){var b=this.add(c);a.forEach(function(a){b.add.apply(null,a)})},this);this.init(f)}});define("StaticProxy",function(){return function(a){this.trap=function(b,f){var c=a[b];a[b]=function(){f();c()}}}});
define("TinyStore",["Observable","Tools"],function(a,b){return function(f){var c=b.clone(f)||{},d=new a,e=function(a){var h=b.objectsDiffs(a,c);["updated","deleted","added"].forEach(function(a){h[a].forEach(function(b){d.notify(a,b,c[b])})})};this.getNbItems=function(){return c instanceof Array?c.length:b.count(c)};this.get=function(a){return c[a]};this.has=function(a){return c.hasOwnProperty(a)};this.set=function(a,b){var e;return typeof a!="undefined"?(e=this.has(a),c[a]=b,e?d.notify("updated",
a,c[a]):d.notify("added",a,c[a]),true):false};this.del=function(a){return this.has(a)?(this.alter("splice",a,1)||delete c[a],d.notify("deleted",a),true):false};this.alter=function(a){var d,f;return c[a]?(f=b.clone(c),d=c[a].apply(c,Array.prototype.slice.call(arguments,1)),e(f),d):false};this.watch=function(a,b,c){return d.watch(a,b,c)};this.unwatch=function(a){return d.unwatch(a)};this.loop=function(a,d){b.loop(c,a,d)};this.reset=function(a){if(a instanceof Object){var d=b.clone(c);c=b.clone(a)||
{};e(d);return true}else return false}}});
define("Tools",function(){return{getGlobal:function(){return function(){return this}.call(null)},mixin:function(a,b,f){this.loop(a,function(c,d){if(!b[d]||!f)b[d]=a[d]});return b},count:function(a){var b=0;this.loop(a,function(){b++});return b},compareObjects:function(a,b){return Object.getOwnPropertyNames(a).sort().join("")==Object.getOwnPropertyNames(b).sort().join("")},toArray:function(a){return Array.prototype.slice.call(a)},loop:function(a,b,f){var c;if(a instanceof Object&&typeof b=="function"){if(a instanceof
Array)a.forEach(b,f);else for(c in a)a.hasOwnProperty(c)&&b.call(f,a[c],c,a);return true}else return false},objectsDiffs:function(a,b){if(a instanceof Object&&b instanceof Object){var f=[],c=[],d=[],e=[];this.loop(b,function(b,d){b!==a[d]&&typeof a[d]!="undefined"?c.push(d):b===a[d]?f.push(d):typeof a[d]=="undefined"&&e.push(d)});this.loop(a,function(a,c){typeof b[c]=="undefined"&&d.push(c)});return{updated:c,unchanged:f,added:e,deleted:d}}else return false},jsonify:function(a){return a instanceof
Object?JSON.parse(JSON.stringify(a)):false},clone:function(a){return a instanceof Array?a.slice(0):typeof a=="object"&&a!==null&&!(a instanceof RegExp)?this.mixin(a,{}):a}}});
define("Transport",function(){return function(a){var b,f=io;this.connect=function(a){b=f.connect(a);return!!b};this.getSocket=function(){return b};this.on=function(a,d){b.on(a,d)};this.once=function(a,d){b.once(a,d)};this.emit=function(a,d,e){b.emit(a,d,e)};this.request=function(a,d,e){var f=+new Date+Math.floor(Math.random()*1E6);b.once(f,e);d.__eventId__=f;b.emit(a,d)};this.listen=function(a,d,e){var f=+new Date+Math.floor(Math.random()*1E6);b.on(f,e);d.__eventId__=f;b.emit(a,d);return{stop:function(){b.removeListener(f,
e)}}};this.connect(a)}});
