function Emily(){var f={},c={},a=false;this.declare=function(a,d){f[a]=new d(this);return true};this.require=function(b){return a?c[b]:f[b]};this.setUnitTestMode=function(b){a=b};this.getUnitTestMode=function(){return a};this.inject=function(a,d){c[a]=d}}Emily=new Emily;
Emily.declare("Observable",function(){function f(){var c={};this.watch=function(a,b,d){if(typeof a=="string"&&typeof b=="function"){var e=c[a]=c[a]||[];observer=[b,d];e.push(observer);return[a,e.indexOf(observer)]}else return false};this.unwatch=function(a){var b=a[0],a=a[1];return c[b]&&c[b][a]?(c[b][a]=null,true):false};this.notify=function(a,b){var d=c[a],e;if(d){for(e=d.length;e--;)d[e]&&d[e][0].call(d[e][1]||window,b);return true}else return false};this.hasObserver=function(a){return!(!a||!c[a[0]]||
!c[a[0]][a[1]])}}this.create=function(){return new f}});Emily.declare("Promises",function(){});
Emily.declare("TinyStore",function(f){function c(a){var b={},d=f.require("Observable").create();this.length=0;(function(e){for(var a in e)e.hasOwnProperty(a)&&(this.length++,b[a]=e[a])}).call(this,a);this.get=function(a){return b[a]};this.has=function(a){return b.hasOwnProperty(a)};this.set=function(a,c){var f;return typeof a=="string"?(f=b[a],b[a]=c,f||this.length++,d.notify(a,c,f),true):false};this.del=function(a){return this.has(a)?(this.length--,delete b[a],d.notify(a,b[a]),true):false};this.watch=
function(a,b,c){return d.watch(a,b,c)};this.unwatch=function(a){return d.unwatch(a)}}this.create=function(a){return new c(a)}});
