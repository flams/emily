function Emily(){var c={},d={},a={},b=false;this.declare=function(a,b,f){if(typeof b=="string"&&typeof f=="function")f.prototype=new c[b](this);else if(typeof b=="function")f=b;else return false;f.prototype._declaredName=a;d[a]=new f(this);return c[a]=f};this.require=function(g){return b&&a[g]||d[g]||this.require("Tools").getGlobal()[g]};this.setIsolationMode=function(a){b=a};this.getIsolationMode=function(){return b};this.inject=function(b,d){a[b]=d}}Emily=new Emily;
Emily.declare("Observable",function(){function c(){var d={};this.watch=function(a,b,c){if(typeof a=="string"&&typeof b=="function"){var e=d[a]=d[a]||[];observer=[b,c];e.push(observer);return[a,e.indexOf(observer)]}else return false};this.unwatch=function(a){var b=a[0],a=a[1];return d[b]&&d[b][a]?(d[b][a]=null,true):false};this.notify=function(a,b){var c=d[a],e;if(c){for(e=c.length;e--;)c[e]&&c[e][0].call(c[e][1]||null,b);return true}else return false};this.hasObserver=function(a){return!(!a||!d[a[0]]||
!d[a[0]][a[1]])}}this.create=function(){return new c}});Emily.declare("Promises",function(){});
Emily.declare("TinyStore",function(c){function d(a){var b={},d=c.require("Tools"),e=c.require("Observable").create();d.mixin(a,b);this.getNbItems=function(){return d.count(b)};this.get=function(a){return b[a]};this.has=function(a){return b.hasOwnProperty(a)};this.set=function(a,c){var d;return typeof a=="string"?(d=b[a],b[a]=c,e.notify(a,c,d),true):false};this.del=function(a){return this.has(a)?(delete b[a],e.notify(a,b[a]),true):false};this.watch=function(a,b,c){return e.watch(a,b,c)};this.unwatch=
function(a){return e.unwatch(a)}}this.create=function(a){return new d(a)}});Emily.declare("Tools",function(){this.getGlobal=function(){return function(){return this}.call(null)};this.mixin=function(c,d,a){for(var b in c)if(c.hasOwnProperty(b)&&(!d[b]||!a))d[b]=c[b]};this.count=function(c){var d=0,a;for(a in c)c.hasOwnProperty(a)&&d++;return d};this.compareObjects=function(c,d){return Object.getOwnPropertyNames(c).sort().join("")==Object.getOwnPropertyNames(d).sort().join("")};this.toArray=function(c){return Array.prototype.slice.call(c)}});
Emily.declare("Transport",function(c){function d(){var a,b=c.require("io");this.connect=function(c){a=b.connect(c);return this};this.getSocket=function(){return a};this.on=function(b,c){a.on(b,c)};this.emit=function(b,c){a.emit(b,c)}}this.create=function(a){return(new d(a)).connect(a)}});
