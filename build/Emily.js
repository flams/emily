define("Observable",["Tools"],function(b){function a(){var a={};this.watch=function(d,c,b){if(typeof c=="function"){var f=a[d]=a[d]||[];observer=[c,b];f.push(observer);return[d,f.indexOf(observer)]}else return false};this.unwatch=function(d){var c=d[0],d=d[1];return a[c]&&a[c][d]?(a[c][d]=null,true):false};this.notify=function(d){var c=a[d],e;if(c){for(e=c.length;e--;)c[e]&&c[e][0].apply(c[e][1]||null,b.toArray(arguments).slice(1));return true}else return false};this.hasObserver=function(d){return!(!d||
!a[d[0]]||!a[d[0]][d[1]])};this.unwatchAll=function(d){a[d]?delete a[d]:a={};return true}}return{create:function(){return new a}}});
define("StateMachine",function(){function b(){var b={},d="";this.init=function(c){return b[c]?(d=c,true):false};this.add=function(c){return b[c]?false:b[c]=new a};this.get=function(c){return b[c]};this.getCurrent=function(){return d};this.event=function(c,a){var f=b[d].event(c,a);return f===false?false:(d=f||d,true)}}function a(){var a={};this.add=function(d,c,b,f){var h=[];if(a[d])return false;return typeof d=="string"&&typeof c=="function"?(h[0]=c,typeof b=="object"&&(h[1]=b),typeof b=="string"&&
(h[2]=b),typeof f=="string"&&(h[2]=f),a[d]=h,true):false};this.has=function(d){return!!a[d]};this.event=function c(c,b){var f=a[c];return f?(f[0].call(f[1],b),f[2]):false}}return{create:function(a,d){var c=new b,e,f;for(e in d)d.hasOwnProperty(e)&&(f=c.add(e),d[e].forEach(function(c){f.add.apply(null,c)}));c.init(a);return c}}});define("StaticProxy",function(){function b(a){this.trap=function(b,d){var c=a[b];a[b]=function(){d();c()}}}return{create:function(a){return new b(a)}}});
define("TinyStore",["Observable","Tools"],function(b,a){function g(d){var c=a.clone(d)||{},e=b.create(),f=function(b){var d=a.objectsDiffs(b,c);["updated","deleted","added"].forEach(function(a){d[a].forEach(function(b){e.notify(a,b,c[b])})})};this.getNbItems=function(){return c instanceof Array?c.length:a.count(c)};this.get=function(a){return c[a]};this.has=function(a){return c.hasOwnProperty(a)};this.set=function(a,b){var d;return typeof a!="undefined"?(d=this.has(a),c[a]=b,d?e.notify("updated",
a,c[a]):e.notify("added",a,c[a]),true):false};this.del=function(a){return this.has(a)?(this.alter("splice",a,1)||delete c[a],e.notify("deleted",a),true):false};this.alter=function(b){var d,e;return c[b]?(e=a.clone(c),d=c[b].apply(c,Array.prototype.slice.call(arguments,1)),f(e),d):false};this.watch=function(a,c,b){return e.watch(a,c,b)};this.unwatch=function(a){return e.unwatch(a)};this.loop=function(b,d){a.loop(c,b,d)};this.reset=function(b){if(b instanceof Object){var d=a.clone(c);c=a.clone(b)||
{};f(d);return true}else return false}}return{create:function(a){return new g(a)}}});
define("Tools",function(){return{getGlobal:function(){return function(){return this}.call(null)},mixin:function(b,a,g){this.loop(b,function(d,c){if(!a[c]||!g)a[c]=b[c]});return a},count:function(b){var a=0;this.loop(b,function(){a++});return a},compareObjects:function(b,a){return Object.getOwnPropertyNames(b).sort().join("")==Object.getOwnPropertyNames(a).sort().join("")},toArray:function(b){return Array.prototype.slice.call(b)},loop:function(b,a,g){var d;if(b instanceof Object&&typeof a=="function"){if(b instanceof
Array)b.forEach(a,g);else for(d in b)b.hasOwnProperty(d)&&a.call(g,b[d],d,b);return true}else return false},objectsDiffs:function(b,a){if(b instanceof Object&&a instanceof Object){var g=[],d=[],c=[],e=[];this.loop(a,function(a,c){a!==b[c]&&typeof b[c]!="undefined"?d.push(c):a===b[c]?g.push(c):typeof b[c]=="undefined"&&e.push(c)});this.loop(b,function(b,d){typeof a[d]=="undefined"&&c.push(d)});return{updated:d,unchanged:g,added:e,deleted:c}}else return false},jsonify:function(b){return b instanceof
Object?JSON.parse(JSON.stringify(b)):false},clone:function(b){return b instanceof Array?b.slice(0):typeof b=="object"&&b!==null&&!(b instanceof RegExp)?this.mixin(b,{}):b}}});
define("Transport",function(){function b(){var a,b=io;this.connect=function(d){a=b.connect(d);return!!a};this.getSocket=function(){return a};this.on=function(b,c){a.on(b,c)};this.once=function(b,c){a.once(b,c)};this.emit=function(b,c,e){a.emit(b,c,e)};this.request=function(b,c,e){var f=+new Date+Math.floor(Math.random()*1E6);a.once(f,e);c.__eventId__=f;a.emit(b,c)};this.listen=function(b,c,e){var f=+new Date+Math.floor(Math.random()*1E6);a.on(f,e);c.__eventId__=f;a.emit(b,c);return{stop:function(){a.removeListener(f,
e)}}}}return{create:function(a){var g=new b(a);g.connect(a);return g}}});
