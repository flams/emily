function Emily(){var e={},c={},a=false;this.declare=function(b,a){e[b]=new a(this);return true};this.require=function(b){return a?c[b]:e[b]||window[b]};this.setIsolationMode=function(b){a=b};this.getIsolationMode=function(){return a};this.inject=function(a,d){c[a]=d}}Emily=new Emily;
Emily.declare("Observable",function(){function e(){var c={};this.watch=function(a,b,d){if(typeof a=="string"&&typeof b=="function"){var f=c[a]=c[a]||[];observer=[b,d];f.push(observer);return[a,f.indexOf(observer)]}else return false};this.unwatch=function(a){var b=a[0],a=a[1];return c[b]&&c[b][a]?(c[b][a]=null,true):false};this.notify=function(a,b){var d=c[a],f;if(d){for(f=d.length;f--;)d[f]&&d[f][0].call(d[f][1]||window,b);return true}else return false};this.hasObserver=function(a){return!(!a||!c[a[0]]||
!c[a[0]][a[1]])}}this.create=function(){return new e}});Emily.declare("Promises",function(){});
Emily.declare("TinyStore",function(e){function c(a){var b={},d=e.require("Observable").create();this.length=0;(function(f){for(var a in f)f.hasOwnProperty(a)&&(this.length++,b[a]=f[a])}).call(this,a);this.get=function(a){return b[a]};this.has=function(a){return b.hasOwnProperty(a)};this.set=function(a,c){var e;return typeof a=="string"?(e=b[a],b[a]=c,e||this.length++,d.notify(a,c,e),true):false};this.del=function(a){return this.has(a)?(this.length--,delete b[a],d.notify(a,b[a]),true):false};this.watch=
function(a,b,c){return d.watch(a,b,c)};this.unwatch=function(a){return d.unwatch(a)}}this.create=function(a){return new c(a)}});Emily.declare("Transport",function(e){function c(a){var b,c=e.require("io");_connect=function(a){b=c.connect(a)};_getSocket=function(){return b};_on=function(a,c){b.on(a,c)};_emit=function(a,c){b.emit(a,c)};a&&_connect(a);return{connect:_connect,getSocket:_getSocket,on:_on,emit:_emit}}this.create=function(a){return new c(a)}});
