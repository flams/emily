function Emily(){var f={},b={},d=false;this.declare=function(a,c,d){var e={},g,b={},h;typeof c=="function"&&(g=c);if(typeof d=="function")g=d,c.forEach?(h=this.require("Tools").mixin,c.forEach(function(a){h(this.require(a),b)},this)):b=this.require(c),e=Object.create(b);f[a]=e;g(e,this);return true};this.require=function(a){return d?b[a]:f[a]||this.require("Tools").getGlobal()[a]};this.setIsolationMode=function(a){d=a};this.getIsolationMode=function(){return d};this.inject=function(a,c){b[a]=c}}
Emily=new Emily;
Emily.declare("Observable",function(f){function b(){var d={};this.watch=function(a,c,b){if(typeof a=="string"&&typeof c=="function"){var e=d[a]=d[a]||[];observer=[c,b];e.push(observer);return[a,e.indexOf(observer)]}else return false};this.unwatch=function(a){var c=a[0],a=a[1];return d[c]&&d[c][a]?(d[c][a]=null,true):false};this.notify=function(a,c){var b=d[a],e;if(b){for(e=b.length;e--;)b[e]&&b[e][0].call(b[e][1]||null,c);return true}else return false};this.hasObserver=function(a){return!(!a||!d[a[0]]||
!d[a[0]][a[1]])}}f.create=function(){return new b}});Emily.declare("Promises",function(){});
Emily.declare("TinyStore",function(f,b){function d(a){var c={},d=b.require("Tools"),e=b.require("Observable").create();d.mixin(a,c);this.getNbItems=function(){return d.count(c)};this.get=function(a){return c[a]};this.has=function(a){return c.hasOwnProperty(a)};this.set=function(a,b){var d;return typeof a=="string"?(d=c[a],c[a]=b,e.notify(a,b,d),true):false};this.del=function(a){return this.has(a)?(delete c[a],e.notify(a,c[a]),true):false};this.watch=function(a,c,b){return e.watch(a,c,b)};this.unwatch=
function(a){return e.unwatch(a)}}f.create=function(a){return new d(a)}});Emily.declare("Tools",function(f){f.getGlobal=function(){return function(){return this}.call(null)};f.mixin=function(b,d,a){for(var c in b)if(b.hasOwnProperty(c)&&(!d[c]||!a))d[c]=b[c]};f.count=function(b){var d=0,a;for(a in b)b.hasOwnProperty(a)&&d++;return d}});
Emily.declare("Transport",function(f,b){function d(){var a,c=b.require("io");this.connect=function(b){a=c.connect(b);return this};this.getSocket=function(){return a};this.on=function(b,c){a.on(b,c)};this.emit=function(b,c){a.emit(b,c)}}f.create=function(a){return(new d(a)).connect(a)}});
